<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIAP - Sistema Integral de An√°lisis de Procesos v5.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secundario {
            background: #e2e8f0;
            color: #4a5568;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            padding: 10px 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 90px;
            font-size: 12px;
            margin: 2px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .multi-select-container {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            background: #f9f9f9;
            min-height: 50px;
            position: relative;
        }

        .multi-select-item {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
            cursor: pointer;
        }

        .multi-select-item .remove {
            margin-left: 5px;
            color: #ff6b6b;
            font-weight: bold;
            cursor: pointer;
        }

        .dropdown-opciones {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .opcion-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .opcion-item:hover {
            background: #f7fafc;
        }

        .opcion-item:last-child {
            border-bottom: none;
        }

        .alert {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }

        .success {
            background: #c6f6d5;
            border: 1px solid #9ae6b4;
            color: #2f855a;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            min-width: 120px;
            margin: 5px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #4a5568;
            margin-top: 5px;
        }

        .btn-asignar {
            background: #38a169;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 11px;
            margin: 5px;
        }

        .responsable-asignado {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 5px 0;
            display: inline-block;
        }

        .deteccion-con-responsable {
            border-left: 4px solid #38a169;
        }

        .deteccion-sin-responsable {
            border-left: 4px solid #e53e3e;
        }

        .matriz-container {
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .matriz {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .matriz th, .matriz td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: center;
            font-size: 12px;
        }

        .matriz th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .duplicado {
            background-color: #fed7d7 !important;
            color: #c53030;
            font-weight: bold;
        }

        .checkbox-cell {
            padding: 8px;
        }

        .checkbox-cell input[type="checkbox"] {
            transform: scale(1.2);
            cursor: pointer;
        }

        .filtros-analisis {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filtros-analisis label {
            font-weight: bold;
            margin-right: 5px;
        }

        .filtros-analisis select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .actividades-gestion {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .actividad-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        
        .actividad-item.inactiva {
            background: #ffe6e6;
            opacity: 0.7;
        }
        
        .botones-actividad {
            display: flex;
            gap: 5px;
        }
        
        .btn-editar, .btn-estado, .btn-eliminar {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-editar {
            background: #007bff;
            color: white;
        }
        
        .btn-estado {
            background: #28a745;
            color: white;
        }
        
        .btn-eliminar {
            background: #dc3545;
            color: white;
        }

        .btn-eliminar:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .cambio-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .auditoria-info {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 8px 12px;
            margin-top: 8px;
            font-size: 11px;
            color: #666;
            border-left: 3px solid #667eea;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .alerta {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .alerta.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .alerta.info {
            background: #3182ce;
        }
        
        .alerta.success {
            background: #38a169;
        }
        
        .alerta.alert {
            background: #e53e3e;
        }
        
        .btn-delete {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s ease;
        }
        
        .btn-delete:hover {
            background: #c53030;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                min-width: auto;
                margin: 1px 0;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }

            .filtros-analisis {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç SIAP</h1>
            <p>Sistema Integral de An√°lisis de Procesos v5.0</p>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="mostrarSeccion('captura', event)">üìã Captura</div>
            <div class="nav-tab" onclick="mostrarSeccion('configuracion', event)">‚öôÔ∏è Config</div>
            <div class="nav-tab" onclick="mostrarSeccion('usuarios', event)">üë• Usuarios</div>
            <div class="nav-tab" onclick="mostrarSeccion('actividades', event)">üìù Actividades</div>
            <div class="nav-tab" onclick="mostrarSeccion('analisis', event)">üîç An√°lisis</div>
            <div class="nav-tab" onclick="mostrarSeccion('datos', event)">üìä Datos</div>
            <div class="nav-tab" onclick="mostrarSeccion('oportunidades', event)">üí° Mejoras</div>
            <div class="nav-tab" onclick="mostrarSeccion('acciones-mejora', event)">‚ö° Acciones</div>
            <div class="nav-tab" onclick="mostrarSeccion('auditoria', event)">üìù Auditor√≠a</div>
            <div class="nav-tab" onclick="mostrarSeccion('dashboard', event)">üìà Dashboard</div>
        </div>

        <!-- TAB 1: CAPTURA -->
        <div class="tab-content active" id="captura">
            <div class="dashboard">
                <div class="card">
                    <h3>üè¢ Registro de Procesos</h3>
                    <div class="form-group">
                        <label>√Årea:</label>
                        <select id="area">
                            <option value="">Seleccionar √°rea...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puesto/Responsable:</label>
                        <select id="puesto">
                            <option value="">Seleccionar puesto...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Proceso:</label>
                        <input type="text" id="proceso" placeholder="Ej: Validaci√≥n de cliente nuevo">
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n Detallada:</label>
                        <textarea id="descripcion" rows="3" placeholder="Describe paso a paso qu√© se hace en este proceso..."></textarea>
                    </div>
                    
                    <!-- Sistemas como multi-selecci√≥n -->
                    <div class="form-group">
                        <label>Sistemas Utilizados:</label>
                        <div style="position: relative;">
                            <input type="text" id="filtroSistemas" placeholder="üîç Buscar y seleccionar sistemas..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                            <div class="dropdown-opciones" id="sistemasFiltrados"></div>
                        </div>
                        <div class="multi-select-container" id="sistemasSeleccionados" style="margin-top: 10px;">
                            <span style="color: #999; font-style: italic;">No hay sistemas seleccionados</span>
                        </div>
                    </div>

                    <!-- ACTIVIDADES -->
                    <div class="form-group">
                        <label>Actividades que Realiza:</label>
                        <div id="contenedorActividades">
                            <!-- Se llenar√° din√°micamente -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tiempo Estimado (minutos):</label>
                        <input type="number" id="tiempo" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label>Frecuencia:</label>
                        <select id="frecuencia">
                            <option value="">Seleccionar frecuencia...</option>
                            <option>Diario</option>
                            <option>Semanal</option>
                            <option>Mensual</option>
                            <option>Por demanda</option>
                        </select>
                    </div>

                    <!-- Flujo de Informaci√≥n -->
                    <div style="border-top: 2px solid #e2e8f0; margin-top: 20px; padding-top: 20px;">
                        <h4 style="color: #4a5568; margin-bottom: 15px;">üîó Flujo de Informaci√≥n (Opcional)</h4>
                        
                        <!-- Informaci√≥n que Recibe -->
                        <div style="background: #f0fff4; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <h5 style="color: #38a169; margin-bottom: 10px;">üì• Informaci√≥n que Recibe</h5>
                            <div class="form-group">
                                <label>Fuentes de Informaci√≥n:</label>
                                <div style="position: relative;">
                                    <input type="text" id="filtroInfoRecibe" placeholder="üîç Seleccionar fuentes de informaci√≥n..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                                    <button type="button" onclick="mostrarModalNuevaFuente('recibe')" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #38a169; color: white; border: none; border-radius: 3px; padding: 4px 8px; font-size: 12px; cursor: pointer;">‚ûï</button>
                                    <div class="dropdown-opciones" id="fuentesInfoRecibeFiltradas"></div>
                                </div>
                                <div class="multi-select-container" id="fuentesInfoRecibeSeleccionadas" style="margin-top: 10px;">
                                    <span style="color: #999; font-style: italic;">No hay fuentes seleccionadas</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n Detallada:</label>
                                <textarea id="descripcionInfoRecibe" rows="2" placeholder="Describe brevemente qu√© informaci√≥n recibe y c√≥mo la utiliza..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Formato de Recepci√≥n:</label>
                                <div style="position: relative;">
                                    <input type="text" id="filtroFormatoRecibe" placeholder="üîç Seleccionar formatos..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                                    <button type="button" onclick="mostrarModalNuevoFormato('recibe')" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #3182ce; color: white; border: none; border-radius: 3px; padding: 4px 8px; font-size: 12px; cursor: pointer;">‚ûï</button>
                                    <div class="dropdown-opciones" id="formatosRecibeFiltrados"></div>
                                </div>
                                <div class="multi-select-container" id="formatosRecibeSeleccionados" style="margin-top: 10px;">
                                    <span style="color: #999; font-style: italic;">No hay formatos seleccionados</span>
                                </div>
                            </div>
                        </div>

                        <!-- Informaci√≥n que Entrega -->
                        <div style="background: #fef5e7; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <h5 style="color: #f59e0b; margin-bottom: 10px;">üì§ Informaci√≥n que Entrega</h5>
                            <div class="form-group">
                                <label>Destinos de Informaci√≥n:</label>
                                <div style="position: relative;">
                                    <input type="text" id="filtroInfoEntrega" placeholder="üîç Seleccionar destinos de informaci√≥n..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                                    <button type="button" onclick="mostrarModalNuevaFuente('entrega')" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #38a169; color: white; border: none; border-radius: 3px; padding: 4px 8px; font-size: 12px; cursor: pointer;">‚ûï</button>
                                    <div class="dropdown-opciones" id="destinosInfoEntregaFiltrados"></div>
                                </div>
                                <div class="multi-select-container" id="destinosInfoEntregaSeleccionados" style="margin-top: 10px;">
                                    <span style="color: #999; font-style: italic;">No hay destinos seleccionados</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n Detallada:</label>
                                <textarea id="descripcionInfoEntrega" rows="2" placeholder="Describe brevemente qu√© informaci√≥n entrega y c√≥mo la procesa..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Formato de Entrega:</label>
                                <div style="position: relative;">
                                    <input type="text" id="filtroFormatoEntrega" placeholder="üîç Seleccionar formatos..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                                    <button type="button" onclick="mostrarModalNuevoFormato('entrega')" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #3182ce; color: white; border: none; border-radius: 3px; padding: 4px 8px; font-size: 12px; cursor: pointer;">‚ûï</button>
                                    <div class="dropdown-opciones" id="formatosEntregaFiltrados"></div>
                                </div>
                                <div class="multi-select-container" id="formatosEntregaSeleccionados" style="margin-top: 10px;">
                                    <span style="color: #999; font-style: italic;">No hay formatos seleccionados</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="agregarProceso()">Agregar Proceso</button>
                    <input type="file" id="importFile" accept=".csv,.xlsx" onchange="importarDatos()" style="display: none;">
                    <button class="btn" onclick="document.getElementById('importFile').click()" style="background: #3182ce; margin-top: 5px;">üì• Importar Datos</button>
                    <button class="btn" onclick="exportarExcel()" style="background: #38a169; margin-top: 5px;">üìä Exportar a Excel</button>
                </div>
            </div>
        </div>
        <!-- TAB 2: CONFIGURACI√ìN -->
        <div class="tab-content" id="configuracion">
            <div class="dashboard">
                <div class="card">
                    <h3>üè¢ Gesti√≥n de √Åreas</h3>
                    <div class="form-group">
                        <label>Nueva √Årea:</label>
                        <input type="text" id="nuevaArea" placeholder="Ej: Recursos Humanos">
                        <button class="btn" onclick="agregarArea()" style="width: auto; margin-top: 10px;">‚ûï Agregar √Årea</button>
                    </div>
                    <div id="listaAreas" style="margin-top: 15px;"></div>
                </div>

                <div class="card">
                    <h3>üë§ Gesti√≥n de Puestos</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Nuevo Puesto:</label>
                            <input type="text" id="nuevoPuesto" placeholder="Ej: Gerente de Ventas">
                        </div>
                        <div class="form-group">
                            <label>√Årea del Puesto:</label>
                            <select id="areaPuesto">
                                <option value="">Seleccionar √°rea...</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Jefe Inmediato:</label>
                            <select id="jefePuesto">
                                <option value="">Sin jefe asignado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nivel Organizacional:</label>
                            <select id="nivelPuesto">
                                <option>Directivo</option>
                                <option>Gerencial</option>
                                <option>Supervisi√≥n</option>
                                <option>Operativo</option>
                                <option>Apoyo</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="agregarPuesto()" style="width: auto; margin-top: 10px;">‚ûï Agregar Puesto</button>
                    <div id="listaPuestos" style="margin-top: 15px;"></div>
                </div>

                <div class="card">
                    <h3>üíª Gesti√≥n de Sistemas</h3>
                    <div class="form-group">
                        <label>Nuevo Sistema:</label>
                        <input type="text" id="nuevoSistema" placeholder="Ej: Salesforce">
                        <button class="btn" onclick="agregarSistema()" style="width: auto; margin-top: 10px;">‚ûï Agregar Sistema</button>
                    </div>
                    <div id="listaSistemas" style="margin-top: 15px;"></div>
                </div>

                <!-- Registro de Costos de Sistemas -->
                <div class="card">
                    <h3>üí∞ Registro de Costos de Sistemas</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Sistema:</label>
                            <select id="sistemaCoste">
                                <!-- Se llenar√° din√°micamente -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n:</label>
                            <input type="text" id="descripcionCosto" placeholder="Ej: Software de contabilidad">
                        </div>
                    </div>
                    <div style="margin: 20px 0;">
                        <h4 style="color: #4a5568; margin-bottom: 15px;">Tipos de Costo</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px;">
                                <div style="margin-bottom: 10px;">
                                    <input type="checkbox" id="costoPorUso" onchange="habilitarCostoPorUso()" style="margin-right: 8px;">
                                    <label for="costoPorUso" style="font-weight: 600;">Costo por Uso del Sistema</label>
                                </div>
                                <div class="form-group">
                                    <label>Costo ($):</label>
                                    <input type="number" id="costoPorUsoValor" placeholder="500" disabled>
                                </div>
                            </div>
                            <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px;">
                                <div style="margin-bottom: 10px;">
                                    <input type="checkbox" id="costoPorLicencia" onchange="habilitarCostoPorLicencia()" style="margin-right: 8px;">
                                    <label for="costoPorLicencia" style="font-weight: 600;">Costo por Licencias</label>
                                </div>
                                <div class="form-group">
                                    <label>Costo por Licencia ($):</label>
                                    <input type="number" id="costoPorLicenciaValor" placeholder="50" disabled>
                                </div>
                                <div class="form-group">
                                    <label>N√∫mero de Licencias:</label>
                                    <input type="number" id="numLicencias" placeholder="10" disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Forma de Pago:</label>
                            <select id="formaPago">
                                <option>Transferencia</option>
                                <option>Efectivo</option>
                                <option>Tarjeta</option>
                                <option>Otros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Frecuencia:</label>
                            <select id="frecuenciaPago">
                                <option>Mensual</option>
                                <option>Anual</option>
                                <option>Otros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Moneda:</label>
                            <select id="monedaCosto">
                                <option value="MXN">MXN</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="CAD">CAD</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Otros (especificar):</label>
                        <input type="text" id="otrosEspecificar" placeholder="Especificar si aplica">
                    </div>
                    <button class="btn" onclick="agregarCostoSistema()">üí∞ Registrar Costo</button>
                    <div id="listaCostosSistemas" style="margin-top: 20px;"></div>
                </div>

                <div class="card">
                    <h3>üìã Gesti√≥n de Fuentes y Destinos</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Nueva Fuente/Destino:</label>
                            <input type="text" id="nuevaFuenteDestino" placeholder="Ej: √Årea de Contabilidad">
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="tipoFuenteDestino">
                                <option>Fuente de Informaci√≥n</option>
                                <option>Destino de Informaci√≥n</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="agregarFuenteDestino()" style="width: auto; margin-top: 10px;">‚ûï Agregar</button>
                    <div id="listaFuentesDestinos" style="margin-top: 15px;"></div>
                </div>

                <div class="card">
                    <h3>üìÑ Gesti√≥n de Formatos</h3>
                    <div class="form-group">
                        <label>Nuevo Formato:</label>
                        <input type="text" id="nuevoFormatoConfig" placeholder="Ej: API REST">
                        <button class="btn" onclick="agregarFormatoConfig()" style="width: auto; margin-top: 10px;">‚ûï Agregar Formato</button>
                    </div>
                    <div id="listaFormatosConfig" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>

        <!-- TAB 3: USUARIOS -->
        <div class="tab-content" id="usuarios">
            <div class="dashboard">
                <div class="card">
                    <h3>üë• Gesti√≥n de Usuarios</h3>
                    <div style="background: #e3f2fd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">üë§ Usuario Actual</h4>
                        <p><strong id="usuarioActualNombre">Administrador Sistema</strong></p>
                        <p style="color: #666; font-size: 14px;">Rol: <span id="usuarioActualRol">Administrador</span></p>
                        <p style="color: #666; font-size: 14px;">√öltima sesi√≥n: <span id="ultimaSesion">Ahora</span></p>
                    </div>
                    <div style="background: #f0fff4; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #38a169;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">‚ûï Crear Nuevo Usuario</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>Nombre Completo:</label>
                                <input type="text" id="nombreUsuario" placeholder="Ej: Juan P√©rez L√≥pez">
                            </div>
                            <div class="form-group">
                                <label>Usuario/Email:</label>
                                <input type="email" id="emailUsuario" placeholder="juan.perez@empresa.com">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>Rol:</label>
                                <select id="rolUsuario">
                                    <option>Consulta</option>
                                    <option>Editor</option>
                                    <option>Administrador</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>√Årea de Trabajo:</label>
                                <select id="areaUsuario">
                                    <option value="">Todas las √°reas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Estado:</label>
                                <select id="estadoUsuario">
                                    <option>Activo</option>
                                    <option>Inactivo</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="crearUsuario()" style="background: #38a169; color: white; border: none; border-radius: 5px; padding: 9px 16px; cursor: pointer; font-weight: 600;">üë• Crear Usuario</button>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üìã Usuarios del Sistema</h4>
                        <div id="listaUsuarios"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: GESTI√ìN DE ACTIVIDADES -->
        <div class="tab-content" id="actividades">
            <div class="dashboard">
                <div class="card">
                    <h3>üìù Gesti√≥n de Actividades</h3>
                    <!-- Navegaci√≥n cruzada -->
                    <div style="background: #e3f2fd; border-radius: 8px; padding: 10px; margin-bottom: 20px; text-align: center;">
                        <p style="color: #1976d2; margin: 0; font-weight: 600;">üîó Navegaci√≥n R√°pida</p>
                        <button onclick="mostrarSeccion('analisis', event)" style="background: #667eea; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-weight: 600; margin-top: 5px;">üîç Ir a Matriz de An√°lisis</button>
                    </div>
                    
                    <!-- Filtros de b√∫squeda -->
                    <div style="background: #f7fafc; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üîç Filtros de B√∫squeda</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Estado:</label>
                                <select id="filtroEstadoActividad" onchange="filtrarActividades()">
                                    <option value="">Todas</option>
                                    <option value="activa">Activas</option>
                                    <option value="inactiva">Inactivas</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Buscar por Nombre:</label>
                                <input type="text" id="filtroBuscarActividad" onkeyup="filtrarActividades()" placeholder="Buscar actividad..." style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Uso:</label>
                                <select id="filtroUsoActividad" onchange="filtrarActividades()">
                                    <option value="">Todas</option>
                                    <option value="usada">En uso</option>
                                    <option value="no-usada">Sin uso</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button onclick="limpiarFiltrosActividades()" style="background: #e53e3e; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-size: 12px; width: 100%;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <!-- Agregar nueva actividad -->
                    <div style="background: #f0fff4; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #38a169;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">‚ûï Agregar Nueva Actividad</h4>
                        <div style="display: flex; gap: 10px; align-items: end; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Nueva Actividad:</label>
                                <input type="text" id="nuevaActividadGestion" placeholder="Ej: Gestionar Proveedores" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                            </div>
                            <button onclick="agregarActividadGestion()" style="background: #38a169; color: white; border: none; border-radius: 5px; padding: 9px 16px; cursor: pointer; font-weight: 600;">‚ûï Agregar</button>
                        </div>
                    </div>

                    <!-- Estad√≠sticas r√°pidas -->
                    <div class="stats" style="margin-bottom: 20px;">
                        <div class="stat">
                            <div class="stat-number" id="totalActividades">0</div>
                            <div class="stat-label">Total Actividades</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="actividadesActivas">0</div>
                            <div class="stat-label">Activas</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="actividadesInactivas">0</div>
                            <div class="stat-label">Inactivas</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="actividadesEnUso">0</div>
                            <div class="stat-label">En Uso</div>
                        </div>
                    </div>

                    <!-- Lista de actividades -->
                    <div>
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üìã Lista de Actividades</h4>
                        <div id="listaActividadesGestionCompleta"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: MATRIZ DE AN√ÅLISIS -->
        <div class="tab-content" id="analisis">
            <!-- Navegaci√≥n cruzada y bot√≥n actualizar an√°lisis -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; border-radius: 10px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <div style="background: #e3f2fd; border-radius: 8px; padding: 10px;">
                    <p style="color: #1976d2; margin: 0; font-weight: 600;">üîó Navegaci√≥n R√°pida</p>
                    <button onclick="mostrarSeccion('actividades', event)" style="background: #38a169; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-weight: 600; margin-top: 5px;">üìù Ir a Gesti√≥n de Actividades</button>
                </div>
                <div>
                    <button onclick="actualizarAnalisisCompleto();" style="background: #667eea; color: white; border: none; border-radius: 8px; padding: 12px 24px; cursor: pointer; font-weight: 600; font-size: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">üîÑ Actualizar An√°lisis Completo</button>
                </div>
            </div>

            <div class="matriz-container">
                <h3>üìä Matriz de Actividades Transversales</h3>
                <p style="margin-bottom: 15px; color: #4a5568;">
                    <strong>Instrucciones:</strong> Marca las casillas de las actividades que realiza cada √°rea. 
                    Las celdas rojas indican actividades duplicadas entre √°reas.
                </p>

                <!-- Filtros para an√°lisis -->
                <div class="filtros-analisis">
                    <label for="filtroAreaAnalisis">üè¢ Filtrar por √Årea:</label>
                    <select id="filtroAreaAnalisis" onchange="filtrarMatriz()">
                        <option value="">Todas las √°reas</option>
                    </select>
                    <label for="filtroActividadAnalisis">üìã Filtrar por Actividad:</label>
                    <select id="filtroActividadAnalisis" onchange="filtrarMatriz()">
                        <option value="">Todas las actividades</option>
                    </select>
                    <label for="filtroEstadoActividadAnalisis">üìä Estado Actividad:</label>
                    <select id="filtroEstadoActividadAnalisis" onchange="filtrarMatriz()">
                        <option value="">Todas</option>
                        <option value="activa">Solo Activas</option>
                        <option value="inactiva">Solo Inactivas</option>
                    </select>
                    <label for="filtroAsignacionAnalisis">üë§ Asignaci√≥n:</label>
                    <select id="filtroAsignacionAnalisis" onchange="filtrarDetecciones()">
                        <option value="">Todas</option>
                        <option value="asignado">Con Responsable</option>
                        <option value="sin-asignar">Sin Responsable</option>
                    </select>
                    <button class="btn-secundario" onclick="limpiarFiltrosAnalisis()">üîÑ Limpiar Filtros</button>
                </div>

                <div style="margin-bottom: 15px;">
                    <button class="btn" onclick="llenarMatrizAutomatica()" style="background: #3182ce; width: auto; margin-right: 10px;">ü§ñ Llenar Autom√°tico</button>
                    <button class="btn" onclick="analizarDuplicidades()" style="background: #38a169; width: auto;">üîç Detectar Duplicidades</button>
                    <button class="btn" onclick="persistirDuplicidades()" style="background: #f59e0b; width: auto;">üíæ Guardar Estado Visual</button>
                </div>

                <table class="matriz" id="matrizActividades">
                    <thead>
                        <tr id="headerMatriz">
                            <th style="width: 200px;">Actividad</th>
                        </tr>
                    </thead>
                    <tbody id="matrizBody">
                    </tbody>
                </table>
            </div>
        </div>
        <!-- TAB 6: DATOS CAPTURADOS -->
        <div class="tab-content" id="datos">
            <div class="card">
                <h3>üìä Procesos y Flujos Registrados</h3>
                
                <!-- Filtros -->
                <div style="background: #f7fafc; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; color: #4a5568;">üîç Filtros de B√∫squeda</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por √Årea:</label>
                            <select id="filtroArea" onchange="aplicarFiltros()">
                                <option value="">Todas las √°reas</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Puesto:</label>
                            <select id="filtroPuesto" onchange="aplicarFiltros()">
                                <option value="">Todos los puestos</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Estado:</label>
                            <select id="filtroEstado" onchange="aplicarFiltros()">
                                <option value="">Todos</option>
                                <option value="activo">Activos</option>
                                <option value="inactivo">Inactivos</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Palabra Clave:</label>
                            <input type="text" id="filtroPalabra" onkeyup="aplicarFiltros()" placeholder="Buscar..." style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="limpiarFiltros()" style="background: #e53e3e; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-size: 12px; width: 100%;">üóëÔ∏è Limpiar</button>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <button class="btn" onclick="exportarTodo()" style="background: #38a169; width: auto; display: inline-block; margin-right: 10px;">üìä Exportar Todo</button>
                    <button class="btn" onclick="mostrarPapelera()" style="background: #e53e3e; width: auto; display: inline-block;">üóëÔ∏è Ver Papelera</button>
                </div>

                <div id="listaProcesosYFlujos" style="max-height: 600px; overflow-y: auto;"></div>
            </div>
        </div>

        <!-- TAB 7: OPORTUNIDADES/MEJORAS -->
        <div class="tab-content" id="oportunidades">
            <div class="dashboard">
                <!-- Detecciones con asignaci√≥n de responsables -->
                <div class="card">
                    <h3>‚ö†Ô∏è Detecciones Autom√°ticas de Procesos</h3>
                    <!-- Filtros para detecciones -->
                    <div style="background: #f7fafc; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <label style="font-weight: 600; color: #4a5568;">Filtrar detecciones autom√°ticas:</label>
                            <select id="filtroDeteccionesAutomaticas" onchange="filtrarDeteccionesAutomaticas()">
                                <option value="">Todas</option>
                                <option value="asignado">Con Responsable</option>
                                <option value="sin-asignar">Sin Responsable</option>
                            </select>
                        </div>
                    </div>
                    <div id="alertasAutomaticas"></div>
                </div>

                <div class="card">
                    <h3>üîÑ Actividades en M√∫ltiples Sistemas</h3>
                    <!-- Filtros para actividades en sistemas -->
                    <div style="background: #f7fafc; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <label style="font-weight: 600; color: #4a5568;">Filtrar actividades en sistemas:</label>
                            <select id="filtroActividadesSistemas" onchange="filtrarActividadesSistemas()">
                                <option value="">Todas</option>
                                <option value="asignado">Con Responsable</option>
                                <option value="sin-asignar">Sin Responsable</option>
                            </select>
                        </div>
                    </div>
                    <div id="actividadesSistemas"></div>
                </div>

                <div class="card">
                    <h3>üí∞ An√°lisis de Costos CONFIGURABLES</h3>
                    <div style="background: #f0f9ff; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="color: #1e40af;">‚öôÔ∏è Configuraci√≥n de C√°lculos</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Costo por Hora (MXN):</label>
                                <input type="number" id="costoPorHora" value="150" min="50" max="1000" onchange="actualizarAnalisisCostos()">
                            </div>
                            <div class="form-group">
                                <label>% Ahorro por Duplicidad:</label>
                                <input type="number" id="porcentajeAhorroDuplicidad" value="5" min="1" max="20" onchange="actualizarAnalisisCostos()">
                            </div>
                            <div class="form-group">
                                <label>% Ahorro por Sistema:</label>
                                <input type="number" id="porcentajeAhorroSistema" value="3" min="1" max="15" onchange="actualizarAnalisisCostos()">
                            </div>
                        </div>
                    </div>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-number" id="tiempoTotal">0</div>
                            <div class="stat-label">Horas/Semana en Duplicidades</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="costoEstimado">$0</div>
                            <div class="stat-label">Costo Mensual Estimado</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="sistemas">0</div>
                            <div class="stat-label">Sistemas Redundantes</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üéØ Plan de Acci√≥n Sugerido</h3>
                    <div id="recomendaciones"></div>
                </div>
            </div>
        </div>

        <!-- TAB 8: ACCIONES DE MEJORA -->
        <div class="tab-content" id="acciones-mejora">
            <div class="dashboard">
                <div class="card">
                    <h3>‚ö° Registro de Acciones de Mejora</h3>
                    
                    <!-- Formulario de nueva acci√≥n -->
                    <div style="background: #f0fff4; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #38a169;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">‚ûï Registrar Nueva Acci√≥n</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>Tipo de Acci√≥n:</label>
                                <select id="tipoAccion">
                                    <option>Eliminaci√≥n de Duplicidad</option>
                                    <option>Integraci√≥n de Sistemas</option>
                                    <option>Optimizaci√≥n de Proceso</option>
                                    <option>Capacitaci√≥n</option>
                                    <option>Reorganizaci√≥n</option>
                                    <option>Automatizaci√≥n</option>
                                    <option>Otro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Estado:</label>
                                <select id="estadoAccion">
                                    <option>Planificada</option>
                                    <option>En Progreso</option>
                                    <option>Completada</option>
                                    <option>Cancelada</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Duplicidad/Problema que Aborda:</label>
                            <select id="duplicidadAbordada">
                                <option value="">No relacionado con duplicidad espec√≠fica</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n de la Acci√≥n:</label>
                            <textarea id="descripcionAccion" rows="3" placeholder="Describe la acci√≥n de mejora implementada..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Acciones Espec√≠ficas Tomadas:</label>
                            <textarea id="accionesTomadas" rows="3" placeholder="Detalla brevemente las acciones espec√≠ficas que se tomaron para mejorar..."></textarea>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>Responsable:</label>
                                <input type="text" id="responsableAccion" placeholder="Nombre del responsable">
                            </div>
                            <div class="form-group">
                                <label>Fecha Objetivo:</label>
                                <input type="date" id="fechaObjetivo">
                            </div>
                            <div class="form-group">
                                <label>Ahorro Estimado:</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="ahorroEstimado" placeholder="1000" style="flex: 1;">
                                    <select id="monedaAhorro" style="width: 80px;">
                                        <option value="MXN">MXN</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button onclick="registrarAccion()" style="background: #38a169; color: white; border: none; border-radius: 5px; padding: 9px 16px; cursor: pointer; font-weight: 600;">üìù Registrar Acci√≥n</button>
                    </div>

                    <!-- Filtros para acciones -->
                    <div style="background: #f7fafc; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üîç Filtros</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Estado:</label>
                                <select id="filtroEstadoAcciones" onchange="filtrarAcciones()">
                                    <option value="">Todas</option>
                                    <option value="Planificada">Planificadas</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Completada">Completadas</option>
                                    <option value="Cancelada">Canceladas</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Tipo:</label>
                                <select id="filtroTipoAcciones" onchange="filtrarAcciones()">
                                    <option value="">Todos</option>
                                    <option value="Eliminaci√≥n de Duplicidad">Eliminaci√≥n de Duplicidad</option>
                                    <option value="Integraci√≥n de Sistemas">Integraci√≥n de Sistemas</option>
                                    <option value="Optimizaci√≥n de Proceso">Optimizaci√≥n de Proceso</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Responsable:</label>
                                <input type="text" id="filtroResponsableAcciones" onkeyup="filtrarAcciones()" placeholder="Buscar..." style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button onclick="limpiarFiltrosAcciones()" style="background: #e53e3e; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-size: 12px; width: 100%;">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <div id="listaAcciones"></div>
                </div>
            </div>
        </div>

        <!-- TAB 9: AUDITOR√çA -->
        <div class="tab-content" id="auditoria">
            <div class="dashboard">
                <div class="card">
                    <h3>üìù Registro de Cambios</h3>
                    
                    <!-- Filtros de auditor√≠a -->
                    <div style="background: #f7fafc; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üîç Filtros de Auditor√≠a</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Tipo:</label>
                                <select id="filtroTipoAuditoria" onchange="filtrarAuditoria()">
                                    <option value="">Todos</option>
                                    <option value="proceso">Procesos</option>
                                    <option value="actividad">Actividades</option>
                                    <option value="sistema">Sistemas</option>
                                    <option value="usuario">Usuarios</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Por Usuario:</label>
                                <select id="filtroUsuarioAuditoria" onchange="filtrarAuditoria()">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Fecha Desde:</label>
                                <input type="date" id="fechaDesdeAuditoria" onchange="filtrarAuditoria()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568;">Fecha Hasta:</label>
                                <input type="date" id="fechaHastaAuditoria" onchange="filtrarAuditoria()" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; width: 100%;">
                            </div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas de auditor√≠a -->
                    <div class="stats" style="margin-bottom: 20px;">
                        <div class="stat">
                            <div class="stat-number" id="totalCambios">0</div>
                            <div class="stat-label">Total Cambios</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="cambiosHoy">0</div>
                            <div class="stat-label">Cambios Hoy</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="usuariosActivos">0</div>
                            <div class="stat-label">Usuarios Activos</div>
                        </div>
                    </div>

                    <!-- Lista de cambios -->
                    <div>
                        <h4 style="margin-bottom: 15px; color: #4a5568;">üìã Historial de Cambios</h4>
                        <div id="listaAuditoria" style="max-height: 500px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 10: DASHBOARD -->
        <div class="tab-content" id="dashboard">
            <div class="dashboard">
                <div class="card">
                    <h3>üìà Resumen Ejecutivo</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-number" id="totalProcesos">0</div>
                            <div class="stat-label">Procesos Mapeados</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="duplicidadesEncontradas">0</div>
                            <div class="stat-label">Duplicidades Detectadas</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="ahorrosPotenciales">0%</div>
                            <div class="stat-label">Ahorro Potencial</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="accionesCompletadas">0</div>
                            <div class="stat-label">Acciones Completadas</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üí∞ Costos de Sistemas</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-number" id="costoTotalSistemas">$0</div>
                            <div class="stat-label">Costo Total Mensual</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="totalLicencias">0</div>
                            <div class="stat-label">Total Licencias</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="costoPorUsuario">$0</div>
                            <div class="stat-label">Costo por Usuario</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="ahorroAcumulado">$0</div>
                            <div class="stat-label">Ahorro Acumulado</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= VARIABLES GLOBALES =================
        let procesos = [];
        let flujos = [];
        let papelera = { procesos: [], flujos: [] };
        let areas = ['Administraci√≥n', 'Marketing', 'Comercial', 'Operaciones', 'Importaciones', 'Inventarios'];
        let puestos = [
            { nombre: 'Gerente', area: 'Administraci√≥n', jefe: '', nivel: 'Gerencial' },
            { nombre: 'Analista', area: 'Administraci√≥n', jefe: 'Gerente', nivel: 'Operativo' },
            { nombre: 'Coordinador', area: 'Marketing', jefe: 'Gerente', nivel: 'Supervisi√≥n' },
            { nombre: 'Asistente', area: 'Administraci√≥n', jefe: 'Analista', nivel: 'Apoyo' },
            { nombre: 'Director', area: '', jefe: '', nivel: 'Directivo' },
            { nombre: 'Supervisor', area: 'Operaciones', jefe: 'Gerente', nivel: 'Supervisi√≥n' }
        ];
        let sistemas = ['SAP', 'Excel', 'CRM', 'ERP', 'Email', 'WhatsApp'];
        let costosSistemas = [];
        let actividades = [
            'Validar Cliente', 'Generar Factura', 'Actualizar Inventario', 
            'Procesar Pago', 'Enviar Email', 'Crear Reporte', 
            'Verificar Datos', 'Aprobar Documento', 'Registrar Movimiento',
            'Importar Productos', 'Gestionar Inventario', 'Procesar Orden',
            'Contactar Proveedor', 'Revisar Calidad', 'Calcular Costos'
        ];
        let actividadesInactivas = [];
        let actividadesSeleccionadasTemp = [];
        let sistemasSeleccionadosTemp = [];

        // Variables para informaci√≥n de flujo
        let fuentesInfoRecibe = ['Clientes', 'Proveedores', 'CEDIS', '√Årea Comercial', '√Årea Administrativa', 'Sistemas Externos'];
        let destinosInfoEntrega = ['Clientes', 'Proveedores', 'CEDIS', '√Årea Comercial', '√Årea Administrativa', 'Sistemas Externos', 'Reportes Gerenciales'];
        let formatosDisponibles = ['Excel', 'Email', 'Sistema', 'Papel', 'PDF', 'Digital', 'WhatsApp', 'Telef√≥nico'];
        let fuentesInfoRecibeSeleccionadas = [];
        let destinosInfoEntregaSeleccionados = [];
        let formatosRecibeSeleccionados = [];
        let formatosEntregaSeleccionados = [];

        let usuarios = [
            { id: 1, nombre: 'Administrador Sistema', email: 'admin@empresa.com', rol: 'Administrador', area: '', estado: 'Activo', fechaCreacion: new Date().toISOString(), ultimaSesion: new Date().toISOString() }
        ];
        let usuarioActual = usuarios[0];
        let accionesMejora = [];
        let auditoria = [];
        let deteccionesConResponsable = new Map();
        let duplicidadesDetectadas = [];
        let estadoDuplicidadesPersistente = new Map();
        // ================= FUNCI√ìN PRINCIPAL =================
        function mostrarSeccion(seccionName, event) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(seccionName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.onclick && tab.onclick.toString().includes(seccionName)) {
                        tab.classList.add('active');
                    }
                });
            }
            
            // Inicializar secci√≥n espec√≠fica
            if (seccionName === 'captura') {
                inicializarCaptura();
            } else if (seccionName === 'configuracion') {
                mostrarConfiguracionCompleta();
            } else if (seccionName === 'usuarios') {
                mostrarGestionUsuarios();
            } else if (seccionName === 'actividades') {
                mostrarGestionActividades();
            } else if (seccionName === 'analisis') {
                crearMatriz();
                actualizarFiltrosAnalisis();
                restaurarDuplicidadesVisuales();
            } else if (seccionName === 'datos') {
                mostrarVistaProcesosYFlujos();
            } else if (seccionName === 'oportunidades') {
                generarDeteccionesAutomaticas();
            } else if (seccionName === 'acciones-mejora') {
                mostrarAccionesMejora();
                actualizarDuplicidadesEnSelect();
            } else if (seccionName === 'auditoria') {
                mostrarAuditoria();
            } else if (seccionName === 'dashboard') {
                actualizarDashboard();
            }
        }

        // ================= FUNCI√ìN INICIALIZAR CAPTURA =================
        function inicializarCaptura() {
            actualizarSelectAreas();
            actualizarSelectPuestos();
            validarActividadesDisponibles();
            inicializarSistemasMultiples();
            inicializarInfoRecibe();
            inicializarInfoEntrega();
            inicializarFormatosMultiples();
        }

        function validarActividadesDisponibles() {
            const contenedor = document.getElementById('contenedorActividades');
            
            if (actividades.length === 0) {
                contenedor.innerHTML = `
                    <div style="border: 2px solid #fed7d7; border-radius: 8px; padding: 15px; background: #fef5e7; text-align: center;">
                        <p style="color: #c53030; margin: 0; font-weight: 600;">‚ö†Ô∏è No hay actividades registradas</p>
                        <p style="color: #c53030; margin: 5px 0 10px 0; font-size: 14px;">Debe agregar actividades en el m√≥dulo de Gesti√≥n de Actividades antes de continuar.</p>
                        <button onclick="mostrarSeccion('actividades', event)" style="background: #38a169; color: white; border: none; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-weight: 600;">üìù Ir a Gesti√≥n de Actividades</button>
                    </div>
                `;
            } else {
                contenedor.innerHTML = `
                    <div style="position: relative;">
                        <input type="text" id="filtroActividades" placeholder="üîç Buscar y seleccionar actividades..." style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px;">
                        <div class="dropdown-opciones" id="actividadesFiltradas"></div>
                    </div>
                    <div class="multi-select-container" id="actividadesSeleccionadas" style="margin-top: 10px;">
                        <span style="color: #999; font-style: italic;">No hay actividades seleccionadas</span>
                    </div>
                `;
                inicializarActividadesMultiples();
            }
        }

        function inicializarSistemasMultiples() {
            const filtroSistemas = document.getElementById('filtroSistemas');
            const sistemasFiltrados = document.getElementById('sistemasFiltrados');
            
            if (!filtroSistemas || !sistemasFiltrados) return;
            
            filtroSistemas.addEventListener('focus', function() {
                mostrarSistemasDisponibles();
            });
            
            filtroSistemas.addEventListener('input', function() {
                const filtro = this.value.toLowerCase().trim();
                
                if (filtro.length === 0) {
                    mostrarSistemasDisponibles();
                    return;
                }
                
                const sistemasFilt = sistemas.filter(sistema => 
                    sistema.toLowerCase().includes(filtro) && 
                    !sistemasSeleccionadosTemp.includes(sistema)
                );
                
                if (sistemasFilt.length > 0) {
                    let html = '';
                    sistemasFilt.slice(0, 10).forEach(sistema => {
                        html += `<div class="opcion-item" onclick="seleccionarSistema('${sistema}')">${sistema}</div>`;
                    });
                    sistemasFiltrados.innerHTML = html;
                    sistemasFiltrados.style.display = 'block';
                } else {
                    sistemasFiltrados.innerHTML = '<div class="opcion-item" style="color: #999; cursor: default;">No se encontraron sistemas</div>';
                    sistemasFiltrados.style.display = 'block';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!filtroSistemas.contains(e.target) && !sistemasFiltrados.contains(e.target)) {
                    sistemasFiltrados.style.display = 'none';
                }
            });
        }

        function mostrarSistemasDisponibles() {
            const sistemasFiltrados = document.getElementById('sistemasFiltrados');
            if (!sistemasFiltrados) return;
            
            const sistemasDisponibles = sistemas.filter(sistema => !sistemasSeleccionadosTemp.includes(sistema));
            
            if (sistemasDisponibles.length > 0) {
                let html = '';
                sistemasDisponibles.forEach(sistema => {
                    html += `<div class="opcion-item" onclick="seleccionarSistema('${sistema}')">${sistema}</div>`;
                });
                sistemasFiltrados.innerHTML = html;
                sistemasFiltrados.style.display = 'block';
            } else {
                sistemasFiltrados.innerHTML = '<div class="opcion-item" style="color: #999; cursor: default;">Todos los sistemas est√°n seleccionados</div>';
                sistemasFiltrados.style.display = 'block';
            }
        }

        function inicializarActividadesMultiples() {
            const filtroActividades = document.getElementById('filtroActividades');
            const actividadesFiltradas = document.getElementById('actividadesFiltradas');
            
            if (!filtroActividades || !actividadesFiltradas) return;
            
            filtroActividades.addEventListener('focus', function() {
                mostrarActividadesDisponibles();
            });
            
            filtroActividades.addEventListener('input', function() {
                const filtro = this.value.toLowerCase().trim();
                
                if (filtro.length === 0) {
                    mostrarActividadesDisponibles();
                    return;
                }
                
                const actividadesFilt = actividades.filter(actividad => 
                    actividad.toLowerCase().includes(filtro) && 
                    !actividadesSeleccionadasTemp.includes(actividad) &&
                    !actividadesInactivas.includes(actividad)
                );
                
                if (actividadesFilt.length > 0) {
                    let html = '';
                    actividadesFilt.slice(0, 10).forEach(actividad => {
                        html += `<div class="opcion-item" onclick="seleccionarActividad('${actividad}')">${actividad}</div>`;
                    });
                    actividadesFiltradas.innerHTML = html;
                    actividadesFiltradas.style.display = 'block';
                } else {
                    actividadesFiltradas.innerHTML = '<div class="opcion-item" style="color: #999; cursor: default;">No se encontraron actividades</div>';
                    actividadesFiltradas.style.display = 'block';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!filtroActividades.contains(e.target) && !actividadesFiltradas.contains(e.target)) {
                    actividadesFiltradas.style.display = 'none';
                }
            });
        }

        function mostrarActividadesDisponibles() {
            const actividadesFiltradas = document.getElementById('actividadesFiltradas');
            if (!actividadesFiltradas) return;
            
            const actividadesDisponibles = actividades.filter(actividad => 
                !actividadesSeleccionadasTemp.includes(actividad) && 
                !actividadesInactivas.includes(actividad)
            );
            
            if (actividadesDisponibles.length > 0) {
                let html = '';
                actividadesDisponibles.forEach(actividad => {
                    html += `<div class="opcion-item" onclick="seleccionarActividad('${actividad}')">${actividad}</div>`;
                });
                actividadesFiltradas.innerHTML = html;
                actividadesFiltradas.style.display = 'block';
            } else {
                actividadesFiltradas.innerHTML = '<div class="opcion-item" style="color: #999; cursor: default;">Todas las actividades est√°n seleccionadas</div>';
                actividadesFiltradas.style.display = 'block';
            }
        }

        function seleccionarActividad(actividad) {
            if (!actividadesSeleccionadasTemp.includes(actividad)) {
                actividadesSeleccionadasTemp.push(actividad);
                actualizarVistaActividadesSeleccionadas();
            }
            
            document.getElementById('filtroActividades').value = '';
            document.getElementById('actividadesFiltradas').style.display = 'none';
        }

        function actualizarVistaActividadesSeleccionadas() {
            const container = document.getElementById('actividadesSeleccionadas');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (actividadesSeleccionadasTemp.length === 0) {
                container.innerHTML = '<span style="color: #999; font-style: italic;">No hay actividades seleccionadas</span>';
            } else {
                actividadesSeleccionadasTemp.forEach(actividad => {
                    const chip = document.createElement('span');
                    chip.className = 'multi-select-item';
                    chip.innerHTML = `${actividad} <span class="remove" onclick="eliminarActividadSeleccionada('${actividad}')">√ó</span>`;
                    container.appendChild(chip);
                });
            }
        }

        function eliminarActividadSeleccionada(actividad) {
            actividadesSeleccionadasTemp = actividadesSeleccionadasTemp.filter(a => a !== actividad);
            actualizarVistaActividadesSeleccionadas();
        }

        function seleccionarSistema(sistema) {
            if (!sistemasSeleccionadosTemp.includes(sistema)) {
                sistemasSeleccionadosTemp.push(sistema);
                actualizarVistaSistemasSeleccionados();
            }
            
            document.getElementById('filtroSistemas').value = '';
            document.getElementById('sistemasFiltrados').style.display = 'none';
        }

        function actualizarVistaSistemasSeleccionados() {
            const container = document.getElementById('sistemasSeleccionados');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (sistemasSeleccionadosTemp.length === 0) {
                container.innerHTML = '<span style="color: #999; font-style: italic;">No hay sistemas seleccionados</span>';
            } else {
                sistemasSeleccionadosTemp.forEach(sistema => {
                    const item = document.createElement('span');
                    item.className = 'multi-select-item';
                    item.innerHTML = `${sistema} <span class="remove" onclick="eliminarSistemaSeleccionado('${sistema}')">√ó</span>`;
                    container.appendChild(item);
                });
            }
        }

        function eliminarSistemaSeleccionado(sistema) {
            sistemasSeleccionadosTemp = sistemasSeleccionadosTemp.filter(s => s !== sistema);
            actualizarVistaSistemasSeleccionados();
        }

        // ================= FUNCIONES DE CONFIGURACI√ìN =================
        function mostrarConfiguracionCompleta() {
            actualizarListaAreas();
            actualizarListaPuestos();
            actualizarListaSistemas();
            actualizarListaCostosSistemas();
            actualizarSelectsConfiguracion();
            actualizarListaFuentesDestinos();
            actualizarListaFormatosConfig();
        }

        function actualizarSelectsConfiguracion() {
            actualizarSelectAreas();
            actualizarSelectPuestos();
            actualizarSistemasCostos();
            actualizarSelectsPuestos();
        }

        function actualizarSelectAreas() {
            const select = document.getElementById('area');
            if (select) {
                select.innerHTML = '<option value="">Seleccionar √°rea...</option>';
                areas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    select.appendChild(option);
                });
            }
        }

        function actualizarSelectPuestos() {
            const select = document.getElementById('puesto');
            if (select) {
                select.innerHTML = '<option value="">Seleccionar puesto...</option>';
                puestos.forEach(puesto => {
                    const option = document.createElement('option');
                    option.value = puesto.nombre;
                    option.textContent = `${puesto.nombre}${puesto.area ? ` (${puesto.area})` : ''}`;
                    select.appendChild(option);
                });
            }
        }

        function agregarArea() {
            const nuevaArea = document.getElementById('nuevaArea').value.trim();
            if (nuevaArea && !areas.includes(nuevaArea)) {
                areas.push(nuevaArea);
                registrarCambio('sistema', 'crear', `Nueva √°rea creada: ${nuevaArea}`, null, { nombre: nuevaArea });
                actualizarSelectsConfiguracion();
                crearMatriz();
                actualizarFiltrosAnalisis();
                document.getElementById('nuevaArea').value = '';
                actualizarListaAreas();
                mostrarAlerta('‚úÖ √Årea agregada correctamente', 'success');
            } else if (areas.includes(nuevaArea)) {
                mostrarAlerta('‚ùå Esta √°rea ya existe', 'alert');
            } else {
                mostrarAlerta('‚ùå Ingresa un nombre para el √°rea', 'alert');
            }
        }

        function actualizarListaAreas() {
            const lista = document.getElementById('listaAreas');
            if (!lista) return;
            lista.innerHTML = '';
            
            areas.forEach((area, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f7fafc; border-radius: 5px; margin-bottom: 5px;';
                div.innerHTML = `
                    <span>${area}</span>
                    <div>
                        <button onclick="editarArea('${area}')" style="background: #3182ce; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px; margin-right: 5px;">‚úèÔ∏è Editar</button>
                        ${index >= 6 ? `<button onclick="eliminarArea('${area}')" style="background: #e53e3e; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">üóëÔ∏è Eliminar</button>` : '<small style="color: #666;">Predefinida</small>'}
                    </div>
                `;
                lista.appendChild(div);
            });
        }

        function agregarProceso() {
            const area = document.getElementById('area').value;
            const puesto = document.getElementById('puesto').value;
            const proceso = document.getElementById('proceso').value;
            const descripcion = document.getElementById('descripcion').value;
            const tiempo = parseInt(document.getElementById('tiempo').value) || 0;
            const frecuencia = document.getElementById('frecuencia').value;
            
            const descripcionInfoRecibe = document.getElementById('descripcionInfoRecibe').value;
            const descripcionInfoEntrega = document.getElementById('descripcionInfoEntrega').value;

            if (!proceso.trim() || !area || !puesto || !frecuencia) {
                mostrarAlerta('‚ùå Complete todos los campos requeridos', 'alert');
                return;
            }
            
            if (actividadesSeleccionadasTemp.length === 0) {
                mostrarAlerta('‚ö†Ô∏è Debe seleccionar al menos una actividad', 'alert');
                return;
            }

            const ahora = new Date().toISOString();
            const nuevoProceso = {
                area, puesto, 
                descripcion: proceso,
                proceso, 
                sistemas: sistemasSeleccionadosTemp.length > 0 ? [...sistemasSeleccionadosTemp] : [],
                tiempo, frecuencia,
                actividades: [...actividadesSeleccionadasTemp],
                activo: true,
                id: Date.now(),
                fechaCreacion: ahora,
                usuarioCreacion: usuarioActual.nombre,
                fechaModificacion: ahora,
                usuarioModificacion: usuarioActual.nombre,
                flujoInfo: {
                    fuentesRecibe: [...fuentesInfoRecibeSeleccionadas],
                    destinosEntrega: [...destinosInfoEntregaSeleccionados],
                    descripcionRecibe: descripcionInfoRecibe,
                    descripcionEntrega: descripcionInfoEntrega,
                    formatosRecibe: [...formatosRecibeSeleccionados],
                    formatosEntrega: [...formatosEntregaSeleccionados]
                }
            };
            
            procesos.push(nuevoProceso);

            if (descripcionInfoRecibe.trim() || descripcionInfoEntrega.trim()) {
                flujos.push({
                    procesoRelacionado: `${area} - ${proceso}`,
                    input: descripcionInfoRecibe,
                    output: descripcionInfoEntrega,
                    formato: 'M√∫ltiple',
                    id: Date.now() + 1,
                    fechaCreacion: ahora,
                    usuarioCreacion: usuarioActual.nombre
                });
            }

            registrarCambio('proceso', 'crear', `Nuevo proceso creado: ${area} - ${proceso}`, null, nuevoProceso);

            if (actividadesSeleccionadasTemp.length > 0) {
                setTimeout(() => {
                    actividadesSeleccionadasTemp.forEach(actividad => {
                        const checkbox = document.querySelector(`input[data-area="${area}"][data-actividad="${actividad}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                    verificarDuplicidadesEnMatriz();
                }, 100);
            }

            limpiarFormularioProceso();
            actualizarDashboard();
            mostrarVistaProcesosYFlujos();
            generarDeteccionesAutomaticas();
            mostrarAlerta('‚úÖ Proceso agregado correctamente. Las actividades se mantienen para el siguiente registro.', 'success');
        }

        function limpiarFormularioProceso() {
            document.getElementById('proceso').value = '';
            document.getElementById('descripcion').value = '';
            document.getElementById('tiempo').value = '';
            
            document.getElementById('area').selectedIndex = 0;
            document.getElementById('puesto').selectedIndex = 0;
            document.getElementById('frecuencia').selectedIndex = 0;
            
            sistemasSeleccionadosTemp = [];
            actualizarVistaSistemasSeleccionados();
            document.getElementById('filtroSistemas').value = '';
            
            fuentesInfoRecibeSeleccionadas = [];
            destinosInfoEntregaSeleccionados = [];
            formatosRecibeSeleccionados = [];
            formatosEntregaSeleccionados = [];
            
            actualizarVistaFuentesRecibeSeleccionadas();
            actualizarVistaDestinosEntregaSeleccionados();
            actualizarVistaFormatosRecibeSeleccionados();
            actualizarVistaFormatosEntregaSeleccionados();
            
            document.getElementById('filtroInfoRecibe').value = '';
            document.getElementById('filtroInfoEntrega').value = '';
            document.getElementById('filtroFormatoRecibe').value = '';
            document.getElementById('filtroFormatoEntrega').value = '';
            document.getElementById('descripcionInfoRecibe').value = '';
            document.getElementById('descripcionInfoEntrega').value = '';
        }

        // ================= FUNCIONES DE DETECCI√ìN AUTOM√ÅTICA =================
        function calcularSimilitudMejorada(texto1, texto2) {
            const t1 = texto1.toLowerCase().trim();
            const t2 = texto2.toLowerCase().trim();
            
            const palabras1 = t1.split(' ');
            const palabras2 = t2.split(' ');
            const interseccion = palabras1.filter(palabra => palabras2.includes(palabra));
            const similitudPalabras = Math.round((interseccion.length / Math.max(palabras1.length, palabras2.length)) * 100);
            
            const similitudCaracteres = calcularLevenshtein(t1, t2);
            
            return Math.max(similitudPalabras, similitudCaracteres);
        }

        function calcularLevenshtein(str1, str2) {
            const matrix = [];
            const len1 = str1.length;
            const len2 = str2.length;

            if (len1 === 0) return len2 === 0 ? 100 : 0;
            if (len2 === 0) return 0;

            for (let i = 0; i <= len1; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= len2; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    if (str1.charAt(i - 1) === str2.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }

            const distance = matrix[len1][len2];
            const maxLength = Math.max(len1, len2);
            const similarity = ((maxLength - distance) / maxLength) * 100;
            
            return Math.round(similarity);
        }

        function detectarAutomaticamente() {
            const procesosActivos = procesos.filter(p => p.activo);
            let detecciones = [];
            
            for (let i = 0; i < procesosActivos.length; i++) {
                for (let j = i + 1; j < procesosActivos.length; j++) {
                    const similitud = calcularSimilitudMejorada(procesosActivos[i].descripcion, procesosActivos[j].descripcion);
                    if (similitud > 60) {
                        const deteccionId = `proceso_${procesosActivos[i].id}_${procesosActivos[j].id}`;
                        detecciones.push({
                            id: deteccionId,
                            tipo: 'proceso',
                            similitud: similitud,
                            proceso1: procesosActivos[i],
                            proceso2: procesosActivos[j],
                            metodo: similitud > 80 ? 'Alta similitud' : 'Similitud moderada',
                            responsable: deteccionesConResponsable.get(deteccionId) || null
                        });
                    }
                }
            }
            
            duplicidadesDetectadas = detecciones.filter(d => d.tipo === 'proceso' || d.tipo === 'sistema');
            
            return detecciones;
        }

        function generarDeteccionesAutomaticas() {
            const detecciones = detectarAutomaticamente();
            
            const filtro = document.getElementById('filtroDeteccionesAutomaticas')?.value || '';
            
            const alertasContainer = document.getElementById('alertasAutomaticas');
            if (!alertasContainer) return;
            
            alertasContainer.innerHTML = '';
            
            const procesosDuplicados = detecciones.filter(d => d.tipo === 'proceso');
            const procesosFiltrados = procesosDuplicados.filter(det => {
                if (filtro === 'asignado') return det.responsable;
                if (filtro === 'sin-asignar') return !det.responsable;
                return true;
            });
            
            if (procesosFiltrados.length > 0) {
                procesosFiltrados.forEach(det => {
                    const claseResponsable = det.responsable ? 'deteccion-con-responsable' : 'deteccion-sin-responsable';
                    const div = document.createElement('div');
                    div.className = `alert ${claseResponsable}`;
                    div.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <strong>‚ö†Ô∏è DUPLICIDAD DETECTADA (${det.metodo}):</strong><br>
                                <strong>${det.proceso1.area}: "${det.proceso1.descripcion}"</strong> ‚Üî <strong>${det.proceso2.area}: "${det.proceso2.descripcion}"</strong><br>
                                <em>Similitud: ${det.similitud}% - Algoritmo: ${det.similitud > 80 ? 'Palabras + Caracteres' : det.similitud > 60 ? 'Detecci√≥n por caracteres' : 'Detecci√≥n por palabras'}</em><br>
                                üí∞ <strong>Costo estimado:</strong> ~$500-1,500/mes en tiempo duplicado<br>
                                üéØ <strong>Recomendaci√≥n:</strong> Centralizar en una sola √°rea
                                ${det.responsable ? `<br><div class="responsable-asignado">üë§ Responsable: ${det.responsable}</div>` : ''}
                            </div>
                            <div>
                                ${!det.responsable ? `<button class="btn-asignar" onclick="asignarResponsable('${det.id}', 'Duplicidad: ${det.proceso1.descripcion} vs ${det.proceso2.descripcion}')">üë§ Asignar</button>` : ''}
                            </div>
                        </div>
                    `;
                    alertasContainer.appendChild(div);
                });
            } else {
                if (filtro) {
                    alertasContainer.innerHTML = `<div class="alert">‚ÑπÔ∏è No hay detecciones ${filtro === 'asignado' ? 'con responsable asignado' : 'sin responsable asignado'}</div>`;
                } else {
                    alertasContainer.innerHTML = '<div class="alert success">‚úÖ No se detectaron problemas graves en los procesos actuales</div>';
                }
            }
            
            actualizarOportunidades();
            generarPlanDeAccion();
        }

        function asignarResponsable(deteccionId, descripcion) {
            const responsable = prompt('Asignar responsable a esta detecci√≥n:', '');
            if (responsable && responsable.trim()) {
                deteccionesConResponsable.set(deteccionId, responsable.trim());
                
                const nuevaAccion = {
                    id: Date.now(),
                    tipo: 'Eliminaci√≥n de Duplicidad',
                    estado: 'Planificada',
                    descripcion: descripcion,
                    duplicidadAbordada: deteccionId,
                    accionesTomadas: 'Asignaci√≥n inicial de responsable',
                    responsable: responsable.trim(),
                    fechaObjetivo: '',
                    ahorroEstimado: 0,
                    moneda: 'MXN',
                    fechaCreacion: new Date().toISOString(),
                    usuarioCreacion: usuarioActual.nombre,
                    fechaCompletado: null
                };
                
                accionesMejora.push(nuevaAccion);
                
                registrarCambio('sistema', 'crear', `Responsable asignado y acci√≥n registrada: ${descripcion}`, null, nuevaAccion);
                
                generarDeteccionesAutomaticas();
                mostrarAlerta('‚úÖ Responsable asignado y acci√≥n registrada autom√°ticamente', 'success');
            }
        }

        // ================= FUNCIONES DE UTILIDAD =================
        function mostrarAlerta(mensaje, tipo = 'info') {
            const alerta = document.createElement('div');
            alerta.className = 'alerta ' + tipo;
            alerta.innerHTML = mensaje;
            
            document.body.appendChild(alerta);
            
            setTimeout(() => {
                alerta.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                alerta.classList.remove('show');
                setTimeout(() => {
                    alerta.remove();
                }, 300);
            }, 3000);
        }

        function registrarAuditoria(tipo, detalle) {
            auditoria.push({
                id: Date.now(),
                fecha: new Date().toISOString(),
                usuario: usuarioActual.nombre,
                tipo: tipo,
                detalle: detalle
            });
            guardarDatos();
        }

        function registrarCambio(tipo, accion, detalle, anterior, nuevo) {
            auditoria.push({
                id: Date.now(),
                fecha: new Date().toISOString(),
                usuario: usuarioActual.nombre,
                tipo: tipo,
                accion: accion,
                detalle: detalle,
                valorAnterior: anterior,
                valorNuevo: nuevo
            });
        }

        function guardarDatos() {
            console.log('Datos guardados');
        }

        function cargarDatos() {
            console.log('Datos cargados');
        }

        // ================= FUNCIONES B√ÅSICAS ADICIONALES =================
        function cerrarModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        function editarArea(area) {
            const nuevoNombre = prompt('Nuevo nombre para el √°rea:', area);
            if (nuevoNombre && nuevoNombre.trim() && nuevoNombre !== area) {
                const index = areas.indexOf(area);
                areas[index] = nuevoNombre.trim();
                actualizarSelectsConfiguracion();
                actualizarListaAreas();
                mostrarAlerta('‚úÖ √Årea actualizada', 'success');
            }
        }

        function eliminarArea(area) {
            if (confirm(`¬øEliminar el √°rea "${area}"?`)) {
                const index = areas.indexOf(area);
                areas.splice(index, 1);
                actualizarSelectsConfiguracion();
                actualizarListaAreas();
                mostrarAlerta('üóëÔ∏è √Årea eliminada', 'alert');
            }
        }

        function agregarPuesto() {
            const nuevoPuesto = document.getElementById('nuevoPuesto').value.trim();
            const areaPuesto = document.getElementById('areaPuesto').value;
            const jefePuesto = document.getElementById('jefePuesto').value;
            const nivelPuesto = document.getElementById('nivelPuesto').value;
            
            if (nuevoPuesto) {
                puestos.push({
                    nombre: nuevoPuesto,
                    area: areaPuesto,
                    jefe: jefePuesto,
                    nivel: nivelPuesto
                });
                
                document.getElementById('nuevoPuesto').value = '';
                document.getElementById('areaPuesto').selectedIndex = 0;
                document.getElementById('jefePuesto').selectedIndex = 0;
                document.getElementById('nivelPuesto').selectedIndex = 0;
                
                actualizarSelectsConfiguracion();
                actualizarListaPuestos();
                mostrarAlerta('‚úÖ Puesto agregado', 'success');
            }
        }

        function actualizarListaPuestos() {
            const lista = document.getElementById('listaPuestos');
            if (!lista) return;
            lista.innerHTML = '';
            
            puestos.forEach(puesto => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 10px; background: #f7fafc; border-radius: 5px; margin-bottom: 5px;';
                div.innerHTML = `
                    <strong>${puesto.nombre}</strong><br>
                    <small>${puesto.area || 'Sin √°rea'} - ${puesto.nivel}${puesto.jefe ? ` - Jefe: ${puesto.jefe}` : ''}</small>
                `;
                lista.appendChild(div);
            });
        }

        function agregarSistema() {
            const nuevoSistema = document.getElementById('nuevoSistema').value.trim();
            if (nuevoSistema && !sistemas.includes(nuevoSistema)) {
                sistemas.push(nuevoSistema);
                document.getElementById('nuevoSistema').value = '';
                actualizarSelectsConfiguracion();
                actualizarListaSistemas();
                mostrarAlerta('‚úÖ Sistema agregado', 'success');
            }
        }

        function actualizarListaSistemas() {
            const lista = document.getElementById('listaSistemas');
            if (!lista) return;
            lista.innerHTML = '';
            
            sistemas.forEach(sistema => {
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f7fafc; border-radius: 5px; margin-bottom: 5px;';
                div.innerHTML = `<span>${sistema}</span>`;
                lista.appendChild(div);
            });
        }

        // ================= FUNCIONES STUB PARA COMPLETAR =================
        function actualizarSistemasCostos() { console.log('Sistemas costos actualizados'); }
        function actualizarSelectsPuestos() { console.log('Selects puestos actualizados'); }
        function habilitarCostoPorUso() { console.log('Costo por uso habilitado'); }
        function habilitarCostoPorLicencia() { console.log('Costo por licencia habilitado'); }
        function agregarCostoSistema() { console.log('Costo sistema agregado'); }
        function actualizarListaCostosSistemas() { console.log('Lista costos actualizada'); }
        function agregarFuenteDestino() { console.log('Fuente destino agregada'); }
        function actualizarListaFuentesDestinos() { console.log('Lista fuentes actualizada'); }
        function agregarFormatoConfig() { console.log('Formato config agregado'); }
        function actualizarListaFormatosConfig() { console.log('Lista formatos actualizada'); }
        function mostrarGestionUsuarios() { console.log('Gesti√≥n usuarios mostrada'); }
        function crearUsuario() { console.log('Usuario creado'); }
        function mostrarGestionActividades() { console.log('Gesti√≥n actividades mostrada'); }
        function agregarActividadGestion() { console.log('Actividad agregada'); }
        function filtrarActividades() { console.log('Actividades filtradas'); }
        function limpiarFiltrosActividades() { console.log('Filtros actividades limpiados'); }
        function crearMatriz() { console.log('Matriz creada'); }
        function actualizarFiltrosAnalisis() { console.log('Filtros an√°lisis actualizados'); }
        function restaurarDuplicidadesVisuales() { console.log('Duplicidades visuales restauradas'); }
        function filtrarMatriz() { console.log('Matriz filtrada'); }
        function limpiarFiltrosAnalisis() { console.log('Filtros an√°lisis limpiados'); }
        function llenarMatrizAutomatica() { console.log('Matriz llenada autom√°tica'); }
        function analizarDuplicidades() { console.log('Duplicidades analizadas'); }
        function persistirDuplicidades() { console.log('Duplicidades persistidas'); }
        function verificarDuplicidadesEnMatriz() { console.log('Duplicidades verificadas'); }
        function actualizarAnalisisCompleto() { console.log('An√°lisis completo actualizado'); }
        function mostrarVistaProcesosYFlujos() { console.log('Vista procesos mostrada'); }
        function aplicarFiltros() { console.log('Filtros aplicados'); }
        function limpiarFiltros() { console.log('Filtros limpiados'); }
        function exportarTodo() { console.log('Todo exportado'); }
        function mostrarPapelera() { console.log('Papelera mostrada'); }
        function filtrarDeteccionesAutomaticas() { console.log('Detecciones filtradas'); }
        function filtrarActividadesSistemas() { console.log('Actividades sistemas filtradas'); }
        function actualizarAnalisisCostos() { console.log('An√°lisis costos actualizado'); }
        function actualizarOportunidades() { console.log('Oportunidades actualizadas'); }
        function generarPlanDeAccion() { console.log('Plan acci√≥n generado'); }
        function mostrarAccionesMejora() { console.log('Acciones mejora mostradas'); }
        function actualizarDuplicidadesEnSelect() { console.log('Duplicidades en select actualizadas'); }
        function registrarAccion() { console.log('Acci√≥n registrada'); }
        function filtrarAcciones() { console.log('Acciones filtradas'); }
        function limpiarFiltrosAcciones() { console.log('Filtros acciones limpiados'); }
        function mostrarAuditoria() { console.log('Auditor√≠a mostrada'); }
        function filtrarAuditoria() { console.log('Auditor√≠a filtrada'); }
        function actualizarDashboard() { console.log('Dashboard actualizado'); }
        function inicializarInfoRecibe() { console.log('Info recibe inicializada'); }
        function inicializarInfoEntrega() { console.log('Info entrega inicializada'); }
        function inicializarFormatosMultiples() { console.log('Formatos m√∫ltiples inicializados'); }
        function actualizarVistaFuentesRecibeSeleccionadas() { console.log('Fuentes recibe actualizadas'); }
        function actualizarVistaDestinosEntregaSeleccionados() { console.log('Destinos entrega actualizados'); }
        function actualizarVistaFormatosRecibeSeleccionados() { console.log('Formatos recibe actualizados'); }
        function actualizarVistaFormatosEntregaSeleccionados() { console.log('Formatos entrega actualizados'); }
        function exportarExcel() { console.log('Excel exportado'); }
        function importarDatos() { console.log('Datos importados'); }
        function mostrarModalNuevaFuente() { console.log('Modal nueva fuente mostrado'); }
        function mostrarModalNuevoFormato() { console.log('Modal nuevo formato mostrado'); }

        // ================= INICIALIZACI√ìN DEL SISTEMA =================
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando Sistema SIAP v5.0...');
            
            cargarDatos();
            detectarAutomaticamente();
            actualizarDashboard();
            
            usuarios[0].ultimaSesion = new Date().toISOString();
            registrarAuditoria('Sesi√≥n iniciada', 'Usuario accedi√≥ al sistema SIAP v5.0');
            
            mostrarSeccion('captura');
            
            setTimeout(() => {
                mostrarAlerta('‚úÖ Sistema SIAP v5.0 cargado correctamente', 'success');
            }, 500);
            
            console.log('‚úÖ Sistema SIAP v5.0 iniciado correctamente');
            console.log(`üìä Procesos cargados: ${procesos.length}`);
            console.log(`üîç Duplicidades detectadas: ${duplicidadesDetectadas.length}`);
            console.log(`‚ö° Acciones de mejora: ${accionesMejora.length}`);
            console.log(`üìù Registros de auditor√≠a: ${auditoria.length}`);
        });

        window.addEventListener('error', function(event) {
            console.error('‚ùå Error del sistema:', event.error);
            mostrarAlerta('‚ùå Se produjo un error en el sistema. Revise la consola para m√°s detalles.', 'alert');
            registrarAuditoria('Error del sistema', `Error: ${event.error?.message || 'Error desconocido'}`);
        });

        window.addEventListener('beforeunload', function(event) {
            guardarDatos();
        });

        console.log('üìù SIAP v5.0 - Todas las funciones JavaScript cargadas correctamente');
    </script>
</body>
</html>